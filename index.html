<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>drivingLynX | Secure Connections</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #050505;
            --silver: #e5e5e5;
            --silver-dim: #a3a3a3;
            --accent-blue: #3b82f6; /* Trust color for verification */
        }

        body {
            background-color: var(--bg-dark);
            color: var(--silver);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        /* --- Metallic Typography --- */
        .metallic-text {
            background: linear-gradient(135deg, #ffffff 0%, #b3b3b3 50%, #666666 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
        }

        /* --- Glassmorphism Panels --- */
        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* --- Custom Inputs & Controls --- */
        .lynx-input {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            width: 100%;
            transition: all 0.3s ease;
        }
        .lynx-input:focus { border-color: white; outline: none; background: rgba(255,255,255,0.1); }

        .btn-silver {
            background: linear-gradient(180deg, #ffffff, #9ca3af);
            color: black;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: transform 0.2s;
        }
        .btn-silver:active { transform: scale(0.98); }

        /* --- Toggle Switch for Car Availability --- */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #fff;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #fff;
        }

        /* --- Animations --- */
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .anim-entry { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        .hidden-section { display: none; }
    </style>
</head>
<body>

    <!-- Splash Screen (Same branding) -->
    <div id="splash" class="fixed inset-0 bg-[#050505] z-50 flex flex-col items-center justify-center transition-transform duration-1000 ease-in-out">
        <img src="IMG_0645.png" alt="Logo" class="w-24 h-24 mb-6 animate-pulse">
        <h1 class="text-6xl metallic-text tracking-tighter">drivingLynX</h1>
    </div>

    <!-- Main Navigation -->
    <nav class="h-20 border-b border-white/5 flex justify-between items-center px-6 sticky top-0 bg-black/80 backdrop-blur-md z-40">
        <div class="flex items-center gap-3 cursor-pointer" onclick="goHome()">
            <img src="IMG_0645.png" alt="Logo" class="h-8 w-auto">
            <span class="metallic-text text-lg hidden sm:block">drivingLynX</span>
        </div>
        <div id="navAuthButtons" class="flex gap-4">
            <button onclick="openModal('login')" class="text-xs font-bold text-gray-400 hover:text-white">LOGIN</button>
            <button onclick="startOnboarding()" class="btn-silver px-6 py-2 rounded-full text-xs">JOIN NOW</button>
        </div>
        <div id="navUserArea" class="hidden flex items-center gap-3">
            <span class="text-sm text-gray-400">Welcome, <span id="userNameDisplay" class="text-white font-bold">Driver</span></span>
            <div class="w-8 h-8 rounded-full bg-white/10 border border-white/20"></div>
        </div>
    </nav>

    <!-- LANDING PAGE (Slider View) -->
    <main id="landingView" class="max-w-7xl mx-auto py-12 px-6">
        <div class="grid md:grid-cols-2 gap-6 h-[70vh]">
            <!-- Learner Card -->
            <div onclick="openModal('register', 'learner')" class="glass-panel p-10 flex flex-col justify-end cursor-pointer group hover:bg-white/5 transition-all relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                <div class="relative z-10">
                    <h2 class="text-4xl font-black mb-2 group-hover:translate-x-2 transition-transform">I need a Mentor</h2>
                    <p class="text-gray-400 mb-6">Book instant sessions. Use your car or request one.</p>
                    <div class="flex items-center gap-2 text-xs font-bold uppercase tracking-widest text-white/50">
                        <span>Permit Required</span> â€¢ <span>Insured</span>
                    </div>
                </div>
            </div>

            <!-- Mentor Card -->
            <div onclick="openModal('register', 'mentor')" class="glass-panel p-10 flex flex-col justify-end cursor-pointer group hover:bg-white/5 transition-all relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                <div class="relative z-10">
                    <h2 class="text-4xl font-black mb-2 group-hover:translate-x-2 transition-transform">I want to Mentor</h2>
                    <p class="text-gray-400 mb-6">Earn by supervising. Flexible scheduling.</p>
                    <div class="flex items-center gap-2 text-xs font-bold uppercase tracking-widest text-white/50">
                        <span>Full License Req</span> â€¢ <span>Bg Check</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- DASHBOARD VIEW (Scheduling) -->
    <main id="dashboardView" class="hidden max-w-7xl mx-auto py-12 px-6 anim-entry">
        <div class="flex justify-between items-end mb-8">
            <div>
                <h2 class="text-3xl font-black metallic-text">Quick Schedule</h2>
                <p class="text-gray-400 text-sm mt-1">Showing mentors available for <span class="text-white font-bold">Tomorrow, 10:00 AM</span></p>
            </div>
            <!-- Filter for Car Availability -->
            <div class="flex bg-white/5 rounded-lg p-1">
                <button class="px-4 py-2 text-xs font-bold rounded-md bg-white text-black shadow-lg">All Mentors</button>
                <button class="px-4 py-2 text-xs font-bold rounded-md text-gray-500 hover:text-white">Has Car Only</button>
            </div>
        </div>

        <!-- Mentors Grid -->
        <div class="grid md:grid-cols-3 gap-6">
            <!-- Mentor Card 1 -->
            <div class="glass-panel p-6 hover:border-white/30 transition-all">
                <div class="flex justify-between items-start mb-4">
                    <div class="w-12 h-12 rounded-full bg-gray-700 border-2 border-white/20"></div>
                    <span class="bg-green-500/20 text-green-400 text-[10px] font-bold px-2 py-1 rounded border border-green-500/30">VERIFIED</span>
                </div>
                <h3 class="text-xl font-bold">Sarah Jenkins</h3>
                <p class="text-xs text-gray-400 mb-4">5 Years Experience â€¢ 4.9 â˜…</p>
                
                <div class="space-y-2 mb-6">
                    <div class="flex items-center gap-2 text-xs text-gray-300">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                        <span>Full License Verified</span>
                    </div>
                    <div class="flex items-center gap-2 text-xs text-gray-300">
                        <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        <span>Lynx Insurance Active</span>
                    </div>
                    <div class="flex items-center gap-2 text-xs text-white font-bold bg-white/10 p-2 rounded">
                        <span>ðŸš— Has Vehicle (Toyota Camry)</span>
                    </div>
                </div>
                <button class="btn-silver w-full py-3 rounded-xl text-xs">Book Session ($40/hr)</button>
            </div>

            <!-- Mentor Card 2 -->
            <div class="glass-panel p-6 hover:border-white/30 transition-all">
                <div class="flex justify-between items-start mb-4">
                    <div class="w-12 h-12 rounded-full bg-gray-700 border-2 border-white/20"></div>
                    <span class="bg-green-500/20 text-green-400 text-[10px] font-bold px-2 py-1 rounded border border-green-500/30">VERIFIED</span>
                </div>
                <h3 class="text-xl font-bold">Mike Ross</h3>
                <p class="text-xs text-gray-400 mb-4">12 Years Experience â€¢ 4.8 â˜…</p>
                
                <div class="space-y-2 mb-6">
                    <div class="flex items-center gap-2 text-xs text-gray-300">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                        <span>Full License Verified</span>
                    </div>
                    <div class="flex items-center gap-2 text-xs text-gray-300">
                        <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        <span>Lynx Insurance Active</span>
                    </div>
                    <div class="flex items-center gap-2 text-xs text-gray-500 bg-black/20 p-2 rounded border border-white/5">
                        <span>ðŸš« Uses Your Car Only</span>
                    </div>
                </div>
                <button class="btn-silver w-full py-3 rounded-xl text-xs">Book Session ($30/hr)</button>
            </div>
        </div>
    </main>

    <!-- REGISTRATION WIZARD MODAL -->
    <div id="authModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/90 backdrop-blur-xl p-4">
        <div class="glass-panel w-full max-w-lg p-8 relative overflow-hidden">
            <button onclick="closeModal()" class="absolute top-6 right-6 text-gray-500 hover:text-white">âœ•</button>

            <!-- Steps Progress -->
            <div id="wizardProgress" class="mb-6 hidden">
                <div class="flex justify-between text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-2">
                    <span id="stepLabel">Identity</span>
                    <span id="stepCount">1/4</span>
                </div>
                <div class="h-1 bg-white/10 rounded-full overflow-hidden">
                    <div id="progressBar" class="h-full bg-white transition-all duration-300" style="width: 25%"></div>
                </div>
            </div>

            <form id="wizardForm" onsubmit="handleRegistration(event)">
                
                <!-- Login View -->
                <div id="loginSection" class="hidden-section">
                    <h2 class="text-3xl font-black metallic-text mb-6">Welcome Back</h2>
                    <input type="email" placeholder="Email" class="lynx-input mb-4" required>
                    <input type="password" placeholder="Password" class="lynx-input mb-6" required>
                    <button type="button" onclick="loginSimulation()" class="btn-silver w-full py-4 rounded-xl">ENTER DASHBOARD</button>
                </div>

                <!-- Step 1: Identity (Universal) -->
                <div id="step1" class="hidden-section wizard-step">
                    <h3 class="text-xl font-bold mb-4">Who are you?</h3>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <input type="text" placeholder="First Name" class="lynx-input" required>
                        <input type="text" placeholder="Last Name" class="lynx-input" required>
                    </div>
                    <input type="email" placeholder="Email Address" class="lynx-input mb-4" required>
                    <input type="password" placeholder="Create Password" class="lynx-input" required>
                </div>

                <!-- Step 2: License (Dynamic Label) -->
                <div id="step2" class="hidden-section wizard-step">
                    <h3 class="text-xl font-bold mb-2" id="licenseTitle">License Details</h3>
                    <p class="text-xs text-gray-400 mb-4">We verify this with the DMV database.</p>
                    
                    <input type="text" placeholder="License / Permit Number" class="lynx-input mb-6" required>
                    
                    <div class="border-2 border-dashed border-white/20 rounded-xl p-8 text-center hover:bg-white/5 cursor-pointer transition-colors">
                        <svg class="w-8 h-8 mx-auto text-gray-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        <span class="text-xs font-bold uppercase tracking-widest text-gray-400">Upload Front of Card</span>
                    </div>
                </div>

                <!-- Step 3: Vehicle Logistics -->
                <div id="step3" class="hidden-section wizard-step">
                    <h3 class="text-xl font-bold mb-2">Vehicle Availability</h3>
                    <p class="text-xs text-gray-400 mb-6" id="carSubtext">Do you have a car for lessons?</p>

                    <div class="flex gap-4 mb-6">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="hasCar" value="yes" class="peer sr-only" onchange="toggleCarDetails(true)">
                            <div class="p-4 rounded-xl bg-white/5 border border-white/10 peer-checked:bg-white peer-checked:text-black text-center transition-all">
                                <span class="font-bold">YES</span>
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="hasCar" value="no" class="peer sr-only" onchange="toggleCarDetails(false)">
                            <div class="p-4 rounded-xl bg-white/5 border border-white/10 peer-checked:bg-white peer-checked:text-black text-center transition-all">
                                <span class="font-bold">NO</span>
                            </div>
                        </label>
                    </div>

                    <div id="carDetailsForm" class="hidden space-y-4 border-t border-white/10 pt-4">
                        <input type="text" placeholder="Make & Model (e.g. Honda Civic)" class="lynx-input">
                        <input type="text" placeholder="License Plate" class="lynx-input">
                    </div>
                </div>

                <!-- Step 4: Insurance & Safety -->
                <div id="step4" class="hidden-section wizard-step">
                    <h3 class="text-xl font-bold mb-4">Insurance & Protection</h3>
                    
                    <div class="bg-blue-900/20 border border-blue-500/30 p-4 rounded-xl mb-6">
                        <div class="flex gap-3 mb-2">
                            <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <span class="font-bold text-sm text-blue-100">Lynx Liability Protection</span>
                        </div>
                        <p class="text-xs text-blue-200/70">All sessions booked on drivingLynX include secondary liability coverage.</p>
                    </div>

                    <div id="personalInsuranceInput" class="hidden mb-6">
                        <label class="text-xs font-bold uppercase tracking-widest text-gray-500 mb-2 block">Your Vehicle Insurance</label>
                        <input type="text" placeholder="Policy Number" class="lynx-input mb-2">
                        <input type="text" placeholder="Provider Name" class="lynx-input">
                    </div>

                    <label class="flex items-start gap-3 cursor-pointer p-2 hover:bg-white/5 rounded-lg">
                        <input type="checkbox" required class="mt-1">
                        <span class="text-xs text-gray-400">I agree to the Safety Guidelines. I certify my license is valid and not suspended.</span>
                    </label>
                </div>

                <!-- Controls -->
                <div id="wizardControls" class="flex gap-3 mt-8 hidden">
                    <button type="button" onclick="changeStep(-1)" class="px-6 py-4 rounded-xl bg-white/5 font-bold text-gray-400 text-sm hover:bg-white/10">BACK</button>
                    <button type="button" id="nextBtn" onclick="changeStep(1)" class="flex-1 btn-silver py-4 rounded-xl">CONTINUE</button>
                </div>

            </form>
        </div>
    </div>

    <script>
        // --- Configuration ---
const API_BASE_URL = "https://jerin-api.flyai.online/x003/api";

// --- State Management ---
let userRole = 'learner'; 
let currentStep = 1;
const totalSteps = 4;
let hasCar = false;

// --- Splash Screen ---
window.onload = () => {
    setTimeout(() => {
        document.getElementById('splash').style.transform = 'translateY(-100%)';
        checkAuthStatus();
    }, 2000);
};

function checkAuthStatus() {
    const user = JSON.parse(localStorage.getItem('lynx_user'));
    if (user) {
        showDashboard(user);
    }
}

// --- API Integration: Registration ---
async function handleRegistration(e) {
    e.preventDefault();
    const btn = document.getElementById('nextBtn');
    btn.disabled = true;
    btn.innerText = "CREATING ACCOUNT...";

    // Gather data from inputs (Simplified for example - ensure IDs match or use FormData)
    const formData = {
        role: userRole,
        first_name: document.querySelector('#step1 input[placeholder="First Name"]').value,
        last_name: document.querySelector('#step1 input[placeholder="Last Name"]').value,
        email: document.querySelector('#step1 input[placeholder="Email Address"]').value,
        password: document.querySelector('#step1 input[placeholder="Create Password"]').value,
        license_number: document.querySelector('#step2 input').value,
        has_car: hasCar,
        car_make_model: document.querySelector('#carDetailsForm input[placeholder*="Make"]').value || null,
        car_plate: document.querySelector('#carDetailsForm input[placeholder="License Plate"]').value || null
    };

    try {
        const response = await fetch(`${API_BASE_URL}/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });

        if (!response.ok) throw new Error(await response.text());

        alert("Registration Successful! Please login.");
        openModal('login');
    } catch (err) {
        alert("Registration Failed: " + err.message);
    } finally {
        btn.disabled = false;
        btn.innerText = "FINISH REGISTRATION";
    }
}

// --- API Integration: Login ---
async function loginAction() {
    const email = document.querySelector('#loginSection input[type="email"]').value;
    const password = document.querySelector('#loginSection input[type="password"]').value;

    try {
        const response = await fetch(`${API_BASE_URL}/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });

        if (!response.ok) throw new Error("Invalid credentials");

        const data = await response.json();
        localStorage.setItem('lynx_user', JSON.stringify(data.user));
        showDashboard(data.user);
        closeModal();
    } catch (err) {
        alert(err.message);
    }
}

// --- API Integration: Fetch Mentors ---
async function loadMentors(hasCarOnly = false) {
    const grid = document.querySelector('#dashboardView .grid');
    grid.innerHTML = '<p class="text-silver-dim">Searching for mentors...</p>';

    try {
        const response = await fetch(`${API_BASE_URL}/mentors?has_car_only=${hasCarOnly}`);
        const mentors = await response.json();

        grid.innerHTML = mentors.map(mentor => `
            <div class="glass-panel p-6 hover:border-white/30 transition-all anim-entry">
                <div class="flex justify-between items-start mb-4">
                    <div class="w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center border-2 border-white/20">
                        ${mentor.first_name[0]}
                    </div>
                    <span class="bg-green-500/20 text-green-400 text-[10px] font-bold px-2 py-1 rounded border border-green-500/30">VERIFIED</span>
                </div>
                <h3 class="text-xl font-bold">${mentor.first_name} ${mentor.last_name}</h3>
                <p class="text-xs text-gray-400 mb-4">Certified drivingLynX Mentor</p>
                <div class="space-y-2 mb-6">
                    <div class="flex items-center gap-2 text-xs text-gray-300">
                        <span>âœ“ License: ${mentor.license_number.replace(/./g, '*')}</span>
                    </div>
                    ${mentor.has_car ? 
                        `<div class="flex items-center gap-2 text-xs text-white font-bold bg-white/10 p-2 rounded">
                            <span>ðŸš— Vehicle: ${mentor.car_make_model}</span>
                        </div>` : 
                        `<div class="flex items-center gap-2 text-xs text-gray-500 bg-black/20 p-2 rounded">
                            <span>ðŸš« Uses Learner's Car</span>
                        </div>`
                    }
                </div>
                <button class="btn-silver w-full py-3 rounded-xl text-xs">Book Session</button>
            </div>
        `).join('');
    } catch (err) {
        grid.innerHTML = '<p class="text-red-400">Error loading mentors.</p>';
    }
}

// --- UI Logic ---
function showDashboard(user) {
    document.getElementById('landingView').classList.add('hidden');
    document.getElementById('dashboardView').classList.remove('hidden');
    document.getElementById('navAuthButtons').classList.add('hidden');
    document.getElementById('navUserArea').classList.remove('hidden');
    document.getElementById('userNameDisplay').innerText = user.first_name;
    
    // Auto-load mentors if the logged-in user is a learner
    if (user.role === 'learner') loadMentors();
}

function logout() {
    localStorage.removeItem('lynx_user');
    window.location.reload();
}

// --- Previous Navigation Functions (Modal/Step control) remain the same ---
// Note: Ensure you update your "ENTER DASHBOARD" button to call loginAction()
    </script>
</body>
</html>
